!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.parsecWebClient=t():e.parsecWebClient=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!l){var e=s(h);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";(function(e,r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a=(o="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){t=void 0!==(t=t||{})?t:{};var a,s={};for(a in t)t.hasOwnProperty(a)&&(s[a]=t[a]);t.arguments=[],t.thisProgram="./this.program",t.quit=function(e,t){throw t},t.preRun=[],t.postRun=[];var u,c,l=!1,f=!1;l="object"===("undefined"==typeof window?"undefined":i(window)),f="function"==typeof importScripts,u="object"===(void 0===e?"undefined":i(e))&&!l&&!f,c=!l&&!u&&!f;var h,d,p="";function m(e){return t.locateFile?t.locateFile(e,p):p+e}u?(p=r+"/",t.read=function(e,t){var r;return h||(h=n(2)),d||(d=n(3)),e=d.normalize(e),r=h.readFileSync(e),t?r:r.toString()},t.readBinary=function(e){var n=t.read(e,!0);return n.buffer||(n=new Uint8Array(n)),S(n.buffer),n},e.argv.length>1&&(t.thisProgram=e.argv[1].replace(/\\/g,"/")),t.arguments=e.argv.slice(2),e.on("uncaughtException",function(e){if(!(e instanceof ce))throw e}),e.on("unhandledRejection",function(t,n){e.exit(1)}),t.quit=function(t){e.exit(t)},t.inspect=function(){return"[Emscripten Module object]"}):c?("undefined"!=typeof read&&(t.read=function(e){return read(e)}),t.readBinary=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(S("object"===i(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?t.arguments=scriptArgs:void 0!==arguments&&(t.arguments=arguments),"function"==typeof quit&&(t.quit=function(e){quit(e)})):(l||f)&&(l?document.currentScript&&(p=document.currentScript.src):p=self.location.href,o&&(p=o),p=0!==p.indexOf("blob:")?p.split("/").slice(0,-1).join("/")+"/":"",t.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(t.readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),t.readAsync=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},t.setWindowTitle=function(e){document.title=e});var y=t.print||("undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null),v=t.printErr||("undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||y);for(a in s)s.hasOwnProperty(a)&&(t[a]=s[a]);s=void 0;var b=16;function g(e,t){return t||(t=b),e=Math.ceil(e/t)*t}var w={"f64-rem":function(e,t){return e%t},debugger:function(){}},_=(new Array(0),0);function S(e,t){e||fe("Assertion failed: "+t)}var A={stackSave:function(){ue()},stackRestore:function(){se()},arrayToC:function(e){var t,n,r=ae(e.length);return t=e,n=r,M.set(t,n),r},stringToC:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);!function(e,t,n){!function(e,t,n,r){if(!(r>0))return 0;for(var i=n+r-1,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343){var s=e.charCodeAt(++o);a=65536+((1023&a)<<10)|1023&s}if(a<=127){if(n>=i)break;t[n++]=a}else if(a<=2047){if(n+1>=i)break;t[n++]=192|a>>6,t[n++]=128|63&a}else if(a<=65535){if(n+2>=i)break;t[n++]=224|a>>12,t[n++]=128|a>>6&63,t[n++]=128|63&a}else if(a<=2097151){if(n+3>=i)break;t[n++]=240|a>>18,t[n++]=128|a>>12&63,t[n++]=128|a>>6&63,t[n++]=128|63&a}else if(a<=67108863){if(n+4>=i)break;t[n++]=248|a>>24,t[n++]=128|a>>18&63,t[n++]=128|a>>12&63,t[n++]=128|a>>6&63,t[n++]=128|63&a}else{if(n+5>=i)break;t[n++]=252|a>>30,t[n++]=128|a>>24&63,t[n++]=128|a>>18&63,t[n++]=128|a>>12&63,t[n++]=128|a>>6&63,t[n++]=128|63&a}}t[n]=0}(e,E,t,n)}(e,t=ae(n),n)}return t}},k={string:A.stringToC,array:A.arrayToC};function x(e,t){if(0===t||!e)return"";for(var n,r=0,i=0;r|=n=E[e+i>>0],(0!=n||t)&&(i++,!t||i!=t););t||(t=i);var o="";if(r<128){for(var a;t>0;)a=String.fromCharCode.apply(String,E.subarray(e,e+Math.min(t,1024))),o=o?o+a:a,e+=1024,t-=1024;return o}return function(e){return C(E,e)}(e)}var T="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function C(e,t){for(var n=t;e[n];)++n;if(n-t>16&&e.subarray&&T)return T.decode(e.subarray(t,n));for(var r,i,o,a,s,u="";;){if(!(r=e[t++]))return u;if(128&r)if(i=63&e[t++],192!=(224&r))if(o=63&e[t++],224==(240&r)?r=(15&r)<<12|i<<6|o:(a=63&e[t++],240==(248&r)?r=(7&r)<<18|i<<12|o<<6|a:(s=63&e[t++],r=248==(252&r)?(3&r)<<24|i<<18|o<<12|a<<6|s:(1&r)<<30|i<<24|o<<18|a<<12|s<<6|63&e[t++])),r<65536)u+=String.fromCharCode(r);else{var c=r-65536;u+=String.fromCharCode(55296|c>>10,56320|1023&c)}else u+=String.fromCharCode((31&r)<<6|i);else u+=String.fromCharCode(r)}}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var I,M,E,L,R,O,P,j,B,F=65536,D=16777216,K=16777216;function W(e,t){return e%t>0&&(e+=t-e%t),e}function N(e){t.buffer=I=e}function U(){t.HEAP8=M=new Int8Array(I),t.HEAP16=new Int16Array(I),t.HEAP32=L=new Int32Array(I),t.HEAPU8=E=new Uint8Array(I),t.HEAPU16=new Uint16Array(I),t.HEAPU32=new Uint32Array(I),t.HEAPF32=new Float32Array(I),t.HEAPF64=new Float64Array(I)}R=B=0,t.reallocBuffer||(t.reallocBuffer=function(e){var t;try{if(ArrayBuffer.transfer)t=ArrayBuffer.transfer(I,e);else{var n=M;t=new ArrayBuffer(e),new Int8Array(t).set(n)}}catch(e){return!1}return!!oe(t)&&t});try{Function.prototype.call.bind(Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get)(new ArrayBuffer(4))}catch(e){}var H=t.TOTAL_STACK||5242880,q=t.TOTAL_MEMORY||16777216;function V(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var r=n.func;"number"==typeof r?void 0===n.arg?t.dynCall_v(r):t.dynCall_vi(r,n.arg):r(void 0===n.arg?null:n.arg)}else n()}}q<H&&v("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+q+"! (TOTAL_STACK="+H+")"),t.buffer?I=t.buffer:("object"===("undefined"==typeof WebAssembly?"undefined":i(WebAssembly))&&"function"==typeof WebAssembly.Memory?(t.wasmMemory=new WebAssembly.Memory({initial:q/F}),I=t.wasmMemory.buffer):I=new ArrayBuffer(q),t.buffer=I),U();var X=[],z=[],Y=[],G=[],J=!1,Q=0,Z=null,$=null;t.preloadedImages={},t.preloadedAudios={};var ee="data:application/octet-stream;base64,";function te(e){return String.prototype.startsWith?e.startsWith(ee):0===e.indexOf(ee)}!function(){var e="opus.wast",n="opus.wasm",r="opus.temp.asm.js";te(e)||(e=m(e)),te(n)||(n=m(n)),te(r)||(r=m(r));var o={global:null,env:null,asm2wasm:w,parent:t},a=null;function s(){try{if(t.wasmBinary)return new Uint8Array(t.wasmBinary);if(t.readBinary)return t.readBinary(n);throw"both async and sync fetching of the wasm failed"}catch(e){fe(e)}}function u(e,r,u){if("object"!==("undefined"==typeof WebAssembly?"undefined":i(WebAssembly)))return v("no native wasm support detected"),!1;if(!(t.wasmMemory instanceof WebAssembly.Memory))return v("no native wasm Memory in use"),!1;function c(e,n){(a=e.exports).memory&&function(e){var n=t.buffer;e.byteLength<n.byteLength&&v("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here");var r=new Int8Array(n);new Int8Array(e).set(r),N(e),U()}(a.memory),t.asm=a,t.usingWasm=!0,function(e){if(Q--,t.monitorRunDependencies&&t.monitorRunDependencies(Q),0==Q&&(null!==Z&&(clearInterval(Z),Z=null),$)){var n=$;$=null,n()}}()}if(r.memory=t.wasmMemory,o.global={NaN:NaN,Infinity:1/0},o["global.Math"]=Math,o.env=r,Q++,t.monitorRunDependencies&&t.monitorRunDependencies(Q),t.instantiateWasm)try{return t.instantiateWasm(o,c)}catch(e){return v("Module.instantiateWasm callback failed with error: "+e),!1}function h(e){c(e.instance,e.module)}function d(e){(t.wasmBinary||!l&&!f||"function"!=typeof fetch?new Promise(function(e,t){e(s())}):fetch(n,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+n+"'";return e.arrayBuffer()}).catch(function(){return s()})).then(function(e){return WebAssembly.instantiate(e,o)}).then(e).catch(function(e){v("failed to asynchronously prepare wasm: "+e),fe(e)})}return t.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||te(n)||"function"!=typeof fetch?d(h):WebAssembly.instantiateStreaming(fetch(n,{credentials:"same-origin"}),o).then(h).catch(function(e){v("wasm streaming compile failed: "+e),v("falling back to ArrayBuffer instantiation"),d(h)}),{}}t.asmPreload=t.asm;var c=t.reallocBuffer;t.reallocBuffer=function(e){return"asmjs"===h?c(e):function(e){e=W(e,t.usingWasm?F:D);var n=t.buffer.byteLength;if(t.usingWasm)try{return-1!==t.wasmMemory.grow((e-n)/65536)?t.buffer=t.wasmMemory.buffer:null}catch(e){return null}}(e)};var h="";t.asm=function(e,n,r){var o;if(!(n=n).table){var a=t.wasmTableSize;void 0===a&&(a=1024);var s=t.wasmMaxTableSize;"object"===("undefined"==typeof WebAssembly?"undefined":i(WebAssembly))&&"function"==typeof WebAssembly.Table?n.table=void 0!==s?new WebAssembly.Table({initial:a,maximum:s,element:"anyfunc"}):new WebAssembly.Table({initial:a,element:"anyfunc"}):n.table=new Array(a),t.wasmTable=n.table}return n.memoryBase||(n.memoryBase=t.STATIC_BASE),n.tableBase||(n.tableBase=0),S(o=u(0,n),"no binaryen method succeeded."),o}}(),R=33904,z.push(),t.STATIC_BASE=1024,t.STATIC_BUMP=32880;var ne={varargs:0,get:function(e){return ne.varargs+=4,L[ne.varargs-4>>2]},getStr:function(){return x(ne.get())},get64:function(){var e=ne.get(),t=ne.get();return S(e>=0?0===t:-1===t),e},getZero:function(){S(0===ne.get())}};function re(){var e=re;return e.LLVM_SAVEDSTACKS||(e.LLVM_SAVEDSTACKS=[]),e.LLVM_SAVEDSTACKS.push(ue()),e.LLVM_SAVEDSTACKS.length-1}B=R+=16,O=P=g(R=R+4+15&-16),j=g(O+H),L[B>>2]=j,t.wasmTableSize=6,t.wasmMaxTableSize=6,t.asmGlobalArg={},t.asmLibraryArg={abort:fe,enlargeMemory:function(){var e=t.usingWasm?F:D,n=2147483648-e;if(L[B>>2]>n)return!1;var r=q;for(q=Math.max(q,K);q<L[B>>2];)q=q<=536870912?W(2*q,e):Math.min(W((3*q+2147483648)/4,e),n);var i=t.reallocBuffer(q);return i&&i.byteLength==q?(N(i),U(),!0):(q=r,!1)},getTotalMemory:function(){return q},abortOnCannotGrowMemory:function(){fe("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+q+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")},___setErrNo:function(e){return t.___errno_location&&(L[t.___errno_location()>>2]=e),e},___syscall140:function(e,t){ne.varargs=t;try{var n=ne.getStreamFromFD(),r=(ne.get(),ne.get()),i=ne.get(),o=ne.get(),a=r;return FS.llseek(n,a,o),L[i>>2]=n.position,n.getdents&&0===a&&0===o&&(n.getdents=null),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||fe(e),-e.errno}},___syscall146:function e(t,n){ne.varargs=n;try{var r=ne.get(),i=ne.get(),o=ne.get(),a=0;e.buffers||(e.buffers=[null,[],[]],e.printChar=function(t,n){var r=e.buffers[t];S(r),0===n||10===n?((1===t?y:v)(C(r,0)),r.length=0):r.push(n)});for(var s=0;s<o;s++){for(var u=L[i+8*s>>2],c=L[i+(8*s+4)>>2],l=0;l<c;l++)e.printChar(r,E[u+l]);a+=c}return a}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||fe(e),-e.errno}},___syscall54:function(e,t){ne.varargs=t;try{return 0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||fe(e),-e.errno}},___syscall6:function(e,t){ne.varargs=t;try{var n=ne.getStreamFromFD();return FS.close(n),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||fe(e),-e.errno}},_emscripten_memcpy_big:function(e,t,n){return E.set(E.subarray(t,t+n),e),e},_llvm_stackrestore:function(e){var t=re,n=t.LLVM_SAVEDSTACKS[e];t.LLVM_SAVEDSTACKS.splice(e,1),se(n)},_llvm_stacksave:re,DYNAMICTOP_PTR:B,STACKTOP:P};var ie=t.asm(t.asmGlobalArg,t.asmLibraryArg,I);t.asm=ie,t.___errno_location=function(){return t.asm.___errno_location.apply(null,arguments)},t._cleanup=function(){return t.asm._cleanup.apply(null,arguments)},t._decode=function(){return t.asm._decode.apply(null,arguments)},t._decode_buf=function(){return t.asm._decode_buf.apply(null,arguments)};var oe=t._emscripten_replace_memory=function(){return t.asm._emscripten_replace_memory.apply(null,arguments)},ae=(t._encode_buf=function(){return t.asm._encode_buf.apply(null,arguments)},t._init=function(){return t.asm._init.apply(null,arguments)},t.stackAlloc=function(){return t.asm.stackAlloc.apply(null,arguments)}),se=t.stackRestore=function(){return t.asm.stackRestore.apply(null,arguments)},ue=t.stackSave=function(){return t.asm.stackSave.apply(null,arguments)};function ce(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function le(e){function n(){t.calledRun||(t.calledRun=!0,_||(J||(J=!0,V(z)),V(Y),t.onRuntimeInitialized&&t.onRuntimeInitialized(),function(){if(t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;)e=t.postRun.shift(),G.unshift(e);var e;V(G)}()))}e=e||t.arguments,Q>0||(function(){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)e=t.preRun.shift(),X.unshift(e);var e;V(X)}(),Q>0||t.calledRun||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),n()},1)):n()))}function fe(e){throw t.onAbort&&t.onAbort(e),void 0!==e?(y(e),v(e),e=JSON.stringify(e)):e="",_=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(t.asm=ie,t.ccall=function(e,n,r,i,o){var a=function(e){var n=t["_"+e];return S(n,"Cannot call unknown function "+e+", make sure it is exported"),n}(e),s=[],u=0;if(i)for(var c=0;c<i.length;c++){var l=k[r[c]];l?(0===u&&(u=ue()),s[c]=l(i[c])):s[c]=i[c]}var f=a.apply(null,s);return f=function(e){return"string"===n?x(e):"boolean"===n?Boolean(e):e}(f),0!==u&&se(u),f},t.then=function(e){if(t.calledRun)e(t);else{var n=t.onRuntimeInitialized;t.onRuntimeInitialized=function(){n&&n(),e(t)}}return t},ce.prototype=new Error,ce.prototype.constructor=ce,$=function e(){t.calledRun||le(),t.calledRun||($=e)},t.run=le,t.abort=fe,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return t.noExitRuntime=!0,le(),t});t.a=a}).call(this,n(0),"/")},function(e,t){},function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(e){return r.exec(e).slice(1)};function o(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",r=!1,i=arguments.length-1;i>=-1&&!r;i--){var a=i>=0?arguments[i]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,r="/"===a.charAt(0))}return(r?"/":"")+(t=n(o(t.split("/"),function(e){return!!e}),!r).join("/"))||"."},t.normalize=function(e){var r=t.isAbsolute(e),i="/"===a(e,-1);return(e=n(o(e.split("/"),function(e){return!!e}),!r).join("/"))||r||(e="."),e&&i&&(e+="/"),(r?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(o(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),o=r(n.split("/")),a=Math.min(i.length,o.length),s=a,u=0;u<a;u++)if(i[u]!==o[u]){s=u;break}var c=[];for(u=s;u<i.length;u++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=i(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},t.basename=function(e,t){var n=i(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){return i(e)[3]};var a="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(0))},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"connectionUpdate",function(){return l}),n.d(r,"auth",function(){return h}),n.d(r,"serverList",function(){return p});var i={};function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){s(o,r,i,a,u,"next",e)}function u(e){s(o,r,i,a,u,"throw",e)}a(void 0)})}}n.r(i),n.d(i,"addListener",function(){return y}),n.d(i,"removeListeners",function(){return v});var c="parsecgaming.com";function l(e){return f.apply(this,arguments)}function f(){return(f=u(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://".concat(c,"/v1/state/"),{method:"put",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(o({},t,{platform:"web"}))});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function h(e,t){return d.apply(this,arguments)}function d(){return(d=u(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://".concat(c,"/v1/auth"),{method:"post",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({email:t,password:n})});case 2:return r=e.sent,e.next=5,r.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=u(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://".concat(c,"/v1/server-list?include_managed=true"),{method:"get",headers:{"X-Parsec-Session-Id":t}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y(e,t,n,r){var i=r?n.bind(r):n;return e.addEventListener(t,i),[e,t,i]}function v(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a[0].removeEventListener(a[1],a[2])}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}var b={PeerGone:99,Declined:8},g={Kb:0,Mouse:1,MouseWheel:2,Motion:3,Button:4,Axis:5,Unplug:6,Config:8,Cursor:9,Abort:10,Init:11,Reinit:13,Shutter:16,Chat:17,Status:18,Block:19},w={0:0,1:1,2:2,3:3,4:9,5:10,8:4,9:6,10:7,11:8,12:11,13:12,14:13,15:14},_={UpdateWarp:1,UpdateImage:2,UpdateMode:4,IsRelative:256,IsHidden:512,IsTransparent:1024},S={KeyA:4,KeyB:5,KeyC:6,KeyD:7,KeyE:8,KeyF:9,KeyG:10,KeyH:11,KeyI:12,KeyJ:13,KeyK:14,KeyL:15,KeyM:16,KeyN:17,KeyO:18,KeyP:19,KeyQ:20,KeyR:21,KeyS:22,KeyT:23,KeyU:24,KeyV:25,KeyW:26,KeyX:27,KeyY:28,KeyZ:29,Digit1:30,Digit2:31,Digit3:32,Digit4:33,Digit5:34,Digit6:35,Digit7:36,Digit8:37,Digit9:38,Digit0:39,Enter:40,Escape:41,Backspace:42,Tab:43,Space:44,Minus:45,Equal:46,BracketLeft:47,BracketRight:48,Backslash:49,Semicolon:51,Quote:52,Backquote:53,Comma:54,Period:55,Slash:56,CapsLock:57,F1:58,F2:59,F3:60,F4:61,F5:62,F6:63,F7:64,F8:65,F9:66,F10:67,F11:68,F12:69,PrintScreen:70,ScrollLock:71,Pause:72,Insert:73,Home:74,PageUp:75,Delete:76,End:77,PageDown:78,ArrowRight:79,ArrowLeft:80,ArrowDown:81,ArrowUp:82,NumLock:83,NumpadDivide:84,NumpadMultiply:85,NumpadEnter:86,NumpadPlus:87,NumpadMinus:88,Numpad1:89,Numpad2:90,Numpad3:91,Numpad4:92,Numpad5:93,Numpad6:94,Numpad7:95,Numpad8:96,Numpad9:97,Numpad0:98,NumpadPeriod:99,ContextMenu:101,ControlLeft:224,ShiftLeft:225,AltLeft:226,MetaLeft:227,ControlRight:228,ShiftRight:229,AltRight:230,MetaRight:231};function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){k(e,t,n[t])})}return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var T=13;function C(e,t,n,r,i){var o=new DataView(e);o.setInt8(0,t),o.setInt32(1,n),o.setInt32(5,r),o.setInt32(9,i)}function I(e,t,n,r){var i=new ArrayBuffer(T);return C(i,e,t,n,r),i}function M(e,t){var n=new ArrayBuffer(T+t.length+1);return C(n,e,t.length+1,0,0),function(e,t,n){for(var r=(new TextEncoder).encode(n),i=new Int8Array(e,t),o=0;o<n.length;o++)i[o]=r[o]}(n,T,t),n}function E(e,t,n){return I(g.Kb,e,t,n)}function L(e,t,n){return I(g.Axis,e,t,n)}function R(){return I(g.Reinit,0,0,0)}function O(e){return M(g.Config,function(e){for(var t=[],n=Object.entries(e),r=0;r<n.length;r++){var i=n[r];t.push("".concat(i[0],"=").concat(i[1]))}return t.join(":")}(e))}function P(e,t,n){var r=new TextDecoder,i=new Int8Array(e,t,n);return r.decode(i)}function j(e){var t=new DataView(e),n=function(e){return{type:e.getInt8(0),data0:e.getInt32(1),data1:e.getInt32(5),data2:e.getInt32(9)}}(t);switch(n.type){case g.Cursor:return A({},n,function(e){var t=e.getInt32(13),n=e.getInt16(29);return{w:e.getInt16(17),h:e.getInt16(19),x:e.getInt16(21),y:e.getInt16(23),hotX:e.getInt16(25),hotY:e.getInt16(27),relative:!!(n&_.IsRelative),hidden:!!(n&_.IsHidden),data:n&_.UpdateImage?btoa(String.fromCharCode.apply(String,x(new Uint8Array(e.buffer,31,t-1)))):null}}(t));case g.Status:case g.Chat:return A({},n,{str:P(e,T,n.data0-1)})}return n}var B=n(1);function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ctx=new(window.AudioContext||window.webkitAudioContext),this.nextTime=this.ctx.currentTime,this.offset=0,this.bufSource=null,this.left=null,this.right=null,this.encodeU8=null,this.decodeF32=null,this.opus=null,this.ready=!1,this._refreshBuffer(),this.opus=Object(B.a)({onRuntimeInitialized:function(){t.opus.ccall("init","number");var e=t.opus.ccall("encode_buf","number"),n=t.opus.ccall("decode_buf","number");t.encodeU8=new Uint8Array(t.opus.HEAPU8.buffer,e),t.decodeF32=new Float32Array(t.opus.HEAPF32.buffer,n),t.ready=!0},locateFile:function(e){return"".concat(window.location.protocol,"//").concat(window.location.host,"/src/wasm/import-meta.js").substring(0,"".concat(window.location.protocol,"//").concat(window.location.host,"/src/wasm/import-meta.js").lastIndexOf("/")+1)+e}})}var t,n,r;return t=e,(n=[{key:"_refreshBuffer",value:function(){var e=this.ctx.createBuffer(2,1920,48e3);this.left=e.getChannelData(0),this.right=e.getChannelData(1),this.bufSource=this.ctx.createBufferSource(),this.bufSource.buffer=e,this.bufSource.connect(this.ctx.destination),this.offset=0}},{key:"queueData",value:function(e){if(this.ready&&!(this.nextTime-this.ctx.currentTime>.2)){this.encodeU8.set(new Uint8Array(e));for(var t=this.opus.ccall("decode","number",["number"],[e.byteLength]),n=0;n<2*t;n+=2)this.left[this.offset]=this.decodeF32[n],this.right[this.offset]=this.decodeF32[n+1],this.offset++;1920===this.offset&&(this.nextTime<this.ctx.currentTime&&(this.nextTime=this.ctx.currentTime+.07),this.bufSource.start(this.nextTime),this.nextTime+=this.bufSource.buffer.duration,this._refreshBuffer())}}},{key:"destroy",value:function(){try{this.opus.ccall("cleanup")}catch(e){console.error("shutting down opus lib failed with error, ignoring",e)}}}])&&F(t.prototype,n),r&&F(t,r),e}();function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var W=20,N=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onButton=t,this.onAxis=n,this.onDisconnect=r,this.state={},this.interval=setInterval(function(){i._poll()},W)}var t,n,r;return t=e,(n=[{key:"_poll",value:function(){for(var e=navigator.getGamepads(),t=0;t<4;t++)if(e[t]){var n=this.state[t];n||(n=this.state[t]={axes:[],buttons:[]});for(var r=0;r<e[t].buttons.length;r++){var i=e[t].buttons[r].value;void 0!==n.buttons[r]&&n.buttons[r]!==i&&this.onButton(t,r,i),n.buttons[r]=i}for(var o=0;o<e[t].axes.length;o++){var a=e[t].axes[o];Math.abs(a)<.05&&(a=0),void 0!==n.axes[o]&&n.axes[o]!==a&&this.onAxis(t,o,a),n.axes[o]=a}}else this.state[t]&&(delete this.state[t],this.onDisconnect(t))}},{key:"destroy",value:function(){clearInterval(this.interval)}}])&&K(t.prototype,n),r&&K(t,r),e}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e){return e>0?32767*e:32768*e}var q=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.send=n,this.element=t,this.m=null,this.gamepad=null,this.cursorClass=null,this.mouseRelative=!1,this.blockNextEsc=!1,this.listeners=[],this.cache={},this.styles=[],this.cursorId=0,this.inputHandlers=r||[]}var t,n,r;return t=e,(n=[{key:"_mouseMovement",value:function(e){if(this.m){var t,n,r,i=0,o=0,a=0;document.pointerLockElement?(i=1,o=e.movementX,a=e.movementY):(t=e.clientX,n=this.m,(r=Math.round((t-n.mouseOffsetX)*n.mouseMultiX))===n.frameW-1&&(r=n.frameW),r>n.frameW&&(r=n.frameW),r<0&&(r=0),o=r,a=function(e,t){var n=Math.round((e-t.mouseOffsetY)*t.mouseMultiY);return n===t.frameH-1&&(n=t.frameH),n>t.frameH&&(n=t.frameH),n<0&&(n=0),n}(e.clientY,this.m)),this.send(function(e,t,n){return I(g.Motion,e,t,n)}(i,o,a))}}},{key:"_mouseButton",value:function(e){var t="mousedown"===e.type,n=0;if(document.pointerLockElement||this.mouseRelative&&e.target.requestPointerLock(),t&&0===e.button&&e.ctrlKey&&e.shiftKey)e.target.requestPointerLock();else{switch(e.button){case 0:n=1;break;case 1:n=2;break;case 2:n=3;break;case 3:n=4;break;case 4:n=5}this.send(function(e,t){return I(g.Mouse,e,t,0)}(n,t?1:0))}}},{key:"_key",value:function(e){if(e.preventDefault(),!("F5"===e.code&&e.ctrlKey||"KeyI"===e.code&&e.ctrlKey&&e.shiftKey||"F11"===e.code)){var t=S[e.code];if(t){var n=0;e.getModifierState("NumLock")&&(n|=4096),e.getModifierState("CapsLock")&&(n|=8192),this.send(E(t,n,"keydown"===e.type?1:0))}}}},{key:"_mouseWheel",value:function(e){var t,n;e.preventDefault(),this.send((t=-1*e.deltaX/100,n=-1*e.deltaY/100,I(g.MouseWheel,t,n,0)))}},{key:"_contextMenu",value:function(e){e.preventDefault()}},{key:"_button",value:function(e,t,n){if(6===t||7===t)this.send(L(t-2,H(n),e));else{var r=w[t];void 0!==r&&this.send(function(e,t,n){return I(g.Button,e,t,n)}(r,n,e))}}},{key:"_axis",value:function(e,t,n){this.send(L(t,H(n),e))}},{key:"_unplug",value:function(e){this.send(function(e){return I(g.Unplug,0,0,e)}(e))}},{key:"_pointerLock",value:function(){document.pointerLockElement||this.blockNextEsc||(this.send(E(41,0,1)),this.send(E(41,0,0))),this.blockNextEsc=!1}},{key:"_exitPointerLock",value:function(){document.pointerLockElement&&(this.blockNextEsc=!0,document.exitPointerLock())}},{key:"_windowMath",value:function(){var e=this.element.offsetWidth,t=this.element.offsetHeight,n=this.element.videoWidth,r=this.element.videoHeight,i=Math.min(e/n,t/r),o=n*i,a=r*i;this.m={mouseMultiX:n/o,mouseMultiY:r/a,mouseOffsetX:Math.max((e-o)/2,0),mouseOffsetY:Math.max((t-a)/2,0),frameW:n,frameH:r}}},{key:"_setCursorVisibility",value:function(e){this.element.style.cursor=e?"":"none"}},{key:"_clearCursors",value:function(){var e=document.querySelector("head"),t=!0,n=!1,r=void 0;try{for(var i,o=this.styles[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;e.removeChild(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this.cursorClass&&this.element.classList.remove(this.cursorClass)}},{key:"setMouseMode",value:function(e,t){this._setCursorVisibility(!t),this.mouseRelative=e,this.mouseRelative?this.element.requestPointerLock():this._exitPointerLock()}},{key:"setCursor",value:function(e,t,n){if(!this.cache[e]){this.cache[e]="cursor-x-".concat(this.cursorId);var r=document.createElement("style");r.type="text/css",r.innerHTML=".cursor-x-".concat(this.cursorId++," ")+"{cursor: url(data:image/png;base64,".concat(e,") ").concat(t," ").concat(n,", auto;}"),document.querySelector("head").appendChild(r),this.styles.push(r)}this.cursorClass?this.element.classList.replace(this.cursorClass,this.cache[e]):this.element.classList.add(this.cache[e]),this.cursorClass=this.cache[e]}},{key:"attach",value:function(){this.gamepad=new N(this._button.bind(this),this._axis.bind(this),this._unplug.bind(this)),this.listeners.push(y(this.element,"resize",this._windowMath,this)),this.listeners.push(y(this.element,"mousemove",this._mouseMovement,this)),this.listeners.push(y(this.element,"mousedown",this._mouseButton,this)),this.listeners.push(y(this.element,"mouseup",this._mouseButton,this)),this.listeners.push(y(this.element,"mousewheel",this._mouseWheel,this)),this.listeners.push(y(this.element,"contextmenu",this._contextMenu,this)),this.listeners.push(y(document,"pointerlockchange",this._pointerLock,this)),this.listeners.push(y(window,"keydown",this._key,this)),this.listeners.push(y(window,"keyup",this._key,this)),this.listeners.push(y(window,"resize",this._windowMath,this));var e=!0,t=!1,n=void 0;try{for(var r,i=this.inputHandlers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;o&&o.attach&&o.detach&&o.attach(this)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"detach",value:function(){v(this.listeners),this._setCursorVisibility(!0),this._exitPointerLock(),this._clearCursors(),this.gamepad&&this.gamepad.destroy();var e=!0,t=!1,n=void 0;try{for(var r,i=this.inputHandlers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;o&&o.attach&&o.detach&&o.detach(this)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}])&&U(t.prototype,n),r&&U(t,r),e}();function V(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function X(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){V(o,r,i,a,s,"next",e)}function s(e){V(o,r,i,a,s,"throw",e)}a(void 0)})}}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e){for(var t=e.sdp.split("\n"),n={},r=0;r<t.length;r++){var i=t[r].split("="),o=i[0],a=i[1];if(o)if("a"===o){n.a||(n.a={});var s=a.split(/:(.+)/);n.a[s[0]]=s[1]}else n[o]=a}return n}function G(e,t){var n;return"v=0\r\n"+"o=- ".concat((n=new Uint8Array(16),crypto.getRandomValues(n),n.map(function(e){return e%10}).join(""))," 2 IN IP4 127.0.0.1\r\n")+"s=-\r\nt=0 0\r\n"+"a=group:BUNDLE ".concat(t,"\r\n")+"a=msid-semantic: WMS *\r\nm=application 9 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\nb=AS:30\r\n"+"a=ice-ufrag:".concat(e.ice_ufrag,"\r\n")+"a=ice-pwd:".concat(e.ice_pwd,"\r\n")+"a=ice-options:trickle\r\n"+"a=fingerprint:".concat(e.fingerprint,"\r\n")+"a=setup:active\r\n"+"a=mid:".concat(t,"\r\n")+"a=sendrecv\r\na=sctpmap:5000 webrtc-datachannel 256\r\na=max-message-size:1073741823\r\n"}function J(e,t){var n=e.from_stun?"srflx":"host";return"candidate:".concat(2395300328," 1 udp ").concat(2113937151," ").concat(e.candidate_ip," ")+"".concat(e.candidate_port," typ ").concat(n," generation 0 ufrag ").concat(t.ice_ufrag," network-cost 50")}var Q=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onCandidate=r,this.attemptId=n,this.serverId=t,this.synced=!1,this.started=!1,this.sdp=null,this.rtc=null,this.channels={},this.offer=null,this.rtc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.parsec.gg:3478"}]}),this.rtc.onicecandidate=function(e){if(e.candidate){var t=e.candidate.candidate.replace("candidate:","").split(" ");"udp"===t[2].toLowerCase()&&i.onCandidate({action:"candidate_exchange",subject:"server",to:i.serverId,attempt_id:i.attemptId,candidate_ip:t[4],candidate_port:parseInt(t[5]),sync:0,from_stun:"srflx"===t[7]?1:0,lan:"host"===t[7]?1:0})}}}var t,n,r;return t=e,(n=[{key:"close",value:function(){for(var e=Object.entries(this.channels),t=0;t<e.length;t++){e[t][1].close()}this.rtc.close()}},{key:"addChannel",value:function(e,t,n,r){this.channels[t]=this.rtc.createDataChannel(e,{id:t}),this.channels[t].binaryType="arraybuffer",this.channels[t].onopen=n,this.channels[t].onmessage=r}},{key:"createOffer",value:function(){var e=X(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.rtc.createOffer();case 2:return this.offer=e.sent,this.sdp=Y(this.offer),e.abrupt("return",{ice_ufrag:this.sdp.a["ice-ufrag"],ice_pwd:this.sdp.a["ice-pwd"],fingerprint:this.sdp.a.fingerprint});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(e,t){this.channels[t].send(e)}},{key:"setCandidate",value:function(){var e=X(regeneratorRuntime.mark(function e(t,n){var r,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.started){e.next=7;break}return e.next=3,this.rtc.setLocalDescription(this.offer);case 3:return r=G(n,this.sdp.a.mid),e.next=6,this.rtc.setRemoteDescription({type:"answer",sdp:r});case 6:this.started=!0;case 7:if(t.sync){e.next=11;break}return e.next=10,this.rtc.addIceCandidate({candidate:J(t,n),sdpMid:this.sdp.a.mid,sdpMLineIndex:0});case 10:t.from_stun&&!this.synced&&(setTimeout(function(){i.onCandidate({action:"candidate_exchange",subject:"server",to:i.serverId,attempt_id:i.attemptId,candidate_ip:"1.2.3.4",candidate_port:1234,sync:1,from_stun:0,lan:0})},100),this.synced=!0);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}])&&z(t.prototype,n),r&&z(t,r),e}();function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onFatal=t,this.attemptId=function(){for(var e=[],t=new Uint8Array(4),n=0;n<6;n++)crypto.getRandomValues(t),e.push(Array.from(t).map(function(e){return e.toString(16).padStart(2,"0")}).join(""));return e.join("-")}(),this.theirCreds=null,this.ws=null,this.interval=null}var t,n,r;return t=e,(n=[{key:"connect",value:function(e,t,n,r,i,o){var a=this;this.ws=new WebSocket("wss://".concat(e,":").concat(t)),this.ws.onclose=function(e){1e3!==e.code&&a.onFatal(e.code)},this.ws.onopen=function(){a.send(n,{action:"connection_init",subject:"server",to:r,attempt_id:a.attemptId,timeout_ms:3e4,mode:2,creds:i}),a.interval=setInterval(function(){a.ws.send("PING")},3e4)},this.ws.onmessage=function(e){var t=JSON.parse(e.data);switch(t.action){case"connection_init_response":t.approved||a.onFatal(b.Reject),a.theirCreds=t.creds;break;case"candidate_exchange":o(t,a.theirCreds);break;case"error":a.onFatal(t.code)}}}},{key:"getAttemptId",value:function(){return this.attemptId}},{key:"send",value:function(e,t){t.token=e,this.ws.send(JSON.stringify(t))}},{key:"close",value:function(e){this.ws&&(this.ws.close(e),this.ws=null),clearInterval(this.interval),this.interval=null}}])&&Z(t.prototype,n),r&&Z(t,r),e}();function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var te=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.onFatal=n,this.videoSource=null,this.mediaSource=null,this.waitingForKeyFrame=!0,this.listeners=[],this.queue=[]}var t,n,r;return t=e,(n=[{key:"_submit",value:function(){if(this.queue.length>0&&this.videoSource&&!this.videoSource.updating)try{var e=this.queue.shift();this.videoSource.appendBuffer(e)}catch(e){console.warn(e),this.destroy(),this.onFatal()}}},{key:"_init",value:function(){var e=this;this.mediaSource=new MediaSource,this.element.src=URL.createObjectURL(this.mediaSource),this.element.load(),this.listeners.push(y(this.element,"error",function(){console.error(e.element.error.message)})),this.listeners.push(y(this.mediaSource,"sourceopen",function(){e.videoSource=e.mediaSource.addSourceBuffer('video/mp4; codecs="avc1.64001e"'),e.listeners.push(y(e.videoSource,"update",e._submit,e)),e.element.play()}))}},{key:"_reinit",value:function(){this.destroy(),this._init()}},{key:"destroy",value:function(){this.waitingForKeyFrame=!0,this.element.pause(),v(this.listeners),this.listeners=[],this.mediaSource&&(this.videoSource&&(this.mediaSource.removeSourceBuffer(this.videoSource),this.videoSource=null),this.mediaSource.endOfStream(),URL.revokeObjectURL(this.element.src),this.mediaSource=null)}},{key:"push",value:function(e){var t=new Uint8Array(e);102===t[4]&&(this._reinit(),this.waitingForKeyFrame=!1),this.waitingForKeyFrame||(this.queue.push(t),this._submit())}}])&&ee(t.prototype,n),r&&ee(t,r),e}();function ne(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ie(e){if(e||(e={}),e.network_video_container=2,e.app_ss_endpoint||(e.app_ss_endpoint="signal-load.parsec.tv"),e.app_ss_port||(e.app_ss_port=443),!e.server_resolution_x&&!e.server_resolution_y){var t=window.screen.width,n=window.screen.height;e.server_resolution_x=1920,e.server_resolution_y=1080,t>=800&&n>=600&&t<=1920&&n<=1080&&(e.server_resolution_x=t,e.server_resolution_y=n)}return e}var oe=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onEvent=n,this.audioPlayer=new D,this.connected=!1,this.rtc=null,this.listeners=[],this.logInterval=null,this.videoPlayer=new te(t,function(){i.rtc.send(R(),0)}),this.signal=new $(function(e){i.destroy(4001===e?b.PeerGone:e)}),this.input=new q(t,function(e){i.connected&&i.rtc.send(e,0)},r),this.listeners.push(y(window,"beforeunload",function(){return i.destroy(0),null}))}var t,n,r;return t=e,(n=[{key:"_dispatchEvent",value:function(e){var t=j(e);switch(t.type){case g.Cursor:this.input.setMouseMode(t.relative,t.hidden),t.data&&this.input.setCursor(t.data,t.hotX,t.hotY);break;case g.Abort:this.destroy(t.data0);break;case g.Shutter:this.onEvent({type:"shutter",enabled:!!t.data0});break;case g.Status:this.onEvent({type:"status",msg:t});break;case g.Chat:this.onEvent({type:"chat",msg:t})}}},{key:"connect",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t,n,r){var i,o,a,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=ie(r),i=function(e){s.signal.send(t,e)},o=function(){s.connected=!0,s.logInterval=setInterval(function(){l({attempt_id:s.signal.getAttemptId(),state_str:"LSC_EVENTLOOP"})},6e4),s.listeners.push(y(document,"visibilitychange",function(){document.hidden?(s.videoPlayer.destroy(),s.rtc.send(I(g.Block,0,0,0),0)):s.rtc.send(R(),0)})),s.rtc.send(O(r),0),s.rtc.send(I(g.Init,0,0,0),0),s.input.attach(),s.onEvent({type:"connect"})},this.rtc=new Q(n,this.signal.getAttemptId(),i),this.rtc.addChannel("control",0,o,function(e){s._dispatchEvent(e.data)}),this.rtc.addChannel("video",1,null,function(e){s.videoPlayer.push(e.data)}),this.rtc.addChannel("audio",2,null,function(e){s.audioPlayer.queueData(e.data)}),e.next=9,this.rtc.createOffer();case 9:a=e.sent,this.signal.connect(r.app_ss_endpoint,r.app_ss_port,t,n,a,function(e,t){s.rtc.setCandidate(e,t)});case 11:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){ne(o,r,i,a,s,"next",e)}function s(e){ne(o,r,i,a,s,"throw",e)}a(void 0)})});return function(e,n,r){return t.apply(this,arguments)}}()},{key:"destroy",value:function(e){var t;v(this.listeners),this.signal.close(e>=3e3&&e<5e3?e:1e3),this.videoPlayer.destroy(),this.audioPlayer.destroy(),this.input.detach(),this.connected&&(clearInterval(this.logInterval),this.rtc.send((t=e,I(g.Abort,t,0,0)),0)),l({state_str:"LSC_EXIT",attempt_id:this.signal.getAttemptId(),exit_code:e}),this.rtc.close(),this.connected=!1,this.onEvent({type:"exit",code:e})}}])&&re(t.prototype,n),r&&re(t,r),e}();n.d(t,"api",function(){return ae}),n.d(t,"utils",function(){return se});t.default=oe;var ae=r,se=i}])});